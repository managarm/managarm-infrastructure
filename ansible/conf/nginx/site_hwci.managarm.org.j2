# {{ ansible_managed }}
{% import 'nginx_macros.j2' as h %}

map $http_upgrade $connection_upgrade {
	default upgrade;
	''	close;
}

server {
	listen 443 ssl http2;
	server_name hwci.managarm.org;
        client_max_body_size 128m;

	location /relay/ {
		proxy_buffering         off;
		proxy_redirect          off;
		proxy_http_version      1.1;
		proxy_set_header        Upgrade        $http_upgrade;
		proxy_set_header        Connection     $connection_upgrade;
		proxy_pass              http://localhost:10997/;
	}

	location / {
		return 404;
	}

	{{ h.ssl_keys("hwci.managarm.org") }}
}
